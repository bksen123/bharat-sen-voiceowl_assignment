<div
  class="d-flex justify-content-between align-items-center mb-3 bg-white p-3 rounded shadow-sm"
>
  <h4 class="mb-0 fw-bold">Subscription List</h4>
  <div class="col-sm-6 d-flex">
    <input
      class="form-control me-2"
      type="search"
      placeholder="Search by Name and Description.."
      aria-label="Search"
      [(ngModel)]="searchsubscription"
      name="searchsubscription"
      (ngModelChange)="onSearchChange($event)"
    />

    <button
      type="button"
      data-bs-toggle="modal"
      class="btn dashboard-button-bg text-nowrap"
      (click)="addEditSubscription()"
    >
      <i class="fa fa-plus"> </i> Add new subscription
    </button>
  </div>
</div>

<div style="min-height: 450px" class="bg-white">
  <table class="table">
    <thead>
      <tr>
        <th scope="col">Sr. No</th>
        <!-- <th scope="col">Banner</th> -->
        <th scope="col">Name</th>
        <th scope="col">Description</th>
        <th scope="col">Duration</th>
        <th scope="col">Amount</th>
        <th scope="col">Status</th>
        <th scope="col">Action</th>
      </tr>
    </thead>
    <tbody>
      <tr
        class="align-middle"
        *ngFor="let sub of subscriptionList; let i = index"
      >
        <th scope="row">{{ i + 1 }}</th>
        <!-- Updated Name Column with Image -->
        <!-- <td class="align-middle">
        <div class="d-flex align-items-center gap-2">
          <img [src]="sub.logo_image" alt="member" class="rounded-circle" width="40" height="40" />
        </div>
      </td> -->
        <td class="align-middle">{{ sub.name }}</td>
        <td class="align-middle">{{ sub.description }}</td>
        <td class="align-middle">{{ sub.duration }} Days</td>
        <td class="align-middle">{{ sub.amount }}</td>
        <td class="align-middle">
          <div
            class="custom-toggle"
            [class.active]="sub.is_active === 1"
            (click)="toggleStatus(i, sub)"
          >
            <span class="toggle-label">
              {{ sub.is_active === 1 ? "YES" : "NO" }}
            </span>
            <div class="toggle-knob"></div>
          </div>
        </td>
        <td class="align-middle" style="width: 100px">
          <button
            class="btn me-2 btn-sm view-button"
            (click)="addEditSubscription(sub)"
          >
            <i class="bi bi-pencil-square"></i>
          </button>
          <button
            type="button"
            class="btn view-button btn-sm"
            (click)="showConfirmPopup(sub)"
          >
            <i class="bi bi-trash-fill"></i>
          </button>
        </td>
      </tr>
    </tbody>
  </table>
  <div
    *ngIf="subscriptionList.length === 0"
    class="alert alert-info alert-posstion"
  >
    No subscription found.
  </div>
  <!-- delete modal  -->
</div>
<pagination
  class="custom-pagination"
  [totalItems]="totalItems"
  [(ngModel)]="currentPage"
  [itemsPerPage]="itemsPerPage"
  [maxSize]="5"
  [boundaryLinks]="true"
  previousText="«"
  nextText="»"
  firstText="First"
  lastText="Last"
  (pageChanged)="onPageChange($event)"
>
</pagination>

<!-- delete Subscription Modal -->

<div
  bsModal
  #deleteSubscriptionModal="bs-modal"
  class="modal fade remove-modal-bg"
  tabindex="-1"
  role="dialog"
  aria-labelledby="myModalLabel"
  aria-hidden="true"
  [config]="{ backdrop: 'static', keyboard: false, animated: true }"
>
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title text-center fw-bold">Confirm Delete</h3>
        <!-- <button type="button" class="btn-close" (click)="closeModel()"></button> -->
        <span
          type="button"
          class="btn-close"
          (click)="closeModel()"
          data-bs-dismiss="modal"
          class="fa fa-remove close-modal position-absolute top-0 end-0 m-3 fs-5 cursor-pointer"
        ></span>
      </div>
      <div class="modal-body text-center">
        <b
          >Are you sure you want to delete this
          <span class="text-danger">{{ newSubscription.name }}</span>
          subscription?</b
        >
      </div>
      <!-- <pre>{{newSubscription | json}}</pre> -->
      <div class="modal-footer">
        <button
          type="button"
          class="btn dashboard-button-bg"
          (click)="closeModel()"
        >
          No
        </button>
        <button
          type="button"
          class="btn dashboard-button-bg"
          (click)="confirmDelete()"
        >
          Yes
        </button>
      </div>
    </div>
  </div>
</div>

<div
  bsModal
  #showAddEditSubscriptionModal="bs-modal"
  class="modal fade remove-modal-bg"
  tabindex="-1"
  role="dialog"
  aria-labelledby="myModalLabel"
  aria-hidden="true"
  [config]="{ backdrop: 'static', keyboard: false, animated: true }"
>
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content p-4">
      <div class="modal-header pt-0">
        <h3 class="modal-title text-center fw-bold">
          {{ newSubscription.id ? "Edit" : "Add" }} User
        </h3>
        <!-- <button type="button" class="close" (click)="closeModel()" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button> -->
      </div>
      <div class="modal-body pb-0">
        <form #subscriptionForm="ngForm" novalidate>
          <div class="row">
            <!-- <div class="col-md-6">
              <div class="d-flex  align-items-start pt-4">
                <label for="fileToUpload" class="rounded-circle " data-toggle="tooltip" data-placement="bottom"
                  title="Edit">
                  <div class="profile-pic ">
                    <img id="ImgPreview" [src]="profileImageView()" height="60px" width="60px" class="rounded-circle" />
                  </div>
                  <input type="File" name="fileToUpload" id="fileToUpload" class="form-control" accept="image/*" hidden
                    (change)="onFileChange($event)">
                </label>
              </div>
            </div> -->
            <div class="col-md-6">
              <div class="mb-3">
                <label for="subName" class="form-label">Name</label>
                <input
                  type="text"
                  id="name"
                  [(ngModel)]="newSubscription.name"
                  name="name"
                  class="form-control"
                  placeholder="Name"
                  required
                  minlength="3"
                  #nameCtrl="ngModel"
                />
                <div
                  class="text-danger small"
                  *ngIf="nameCtrl.invalid && nameCtrl.touched"
                >
                  <div *ngIf="nameCtrl.errors?.['required']">
                    Name is required.
                  </div>
                  <div *ngIf="nameCtrl.errors?.['minlength']">
                    Name must be at least 3 characters.
                  </div>
                </div>
              </div>
            </div>

            <div class="col-md-6">
              <div class="mb-3">
                <label for="amount" class="form-label">Amount</label>
                <input
                  type="number"
                  id="amount"
                  [(ngModel)]="newSubscription.amount"
                  name="amount"
                  class="form-control"
                  required
                  min="1"
                  #amountCtrl="ngModel"
                />
                <div
                  class="text-danger small"
                  *ngIf="amountCtrl.invalid && amountCtrl.touched"
                >
                  <div *ngIf="amountCtrl.errors?.['required']">
                    Amount is required.
                  </div>
                  <div *ngIf="amountCtrl.errors?.['min']">
                    Amount must be greater than 0.
                  </div>
                </div>
              </div>
            </div>

            <div class="col-md-6">
              <div class="mb-3">
                <label for="duration" class="form-label">Duration (days)</label>
                <input
                  type="number"
                  id="duration"
                  [(ngModel)]="newSubscription.duration"
                  name="duration"
                  class="form-control"
                  required
                  min="1"
                  #durationCtrl="ngModel"
                />
                <div
                  class="text-danger small"
                  *ngIf="durationCtrl.invalid && durationCtrl.touched"
                >
                  <div *ngIf="durationCtrl.errors?.['required']">
                    Duration is required.
                  </div>
                  <div *ngIf="durationCtrl.errors?.['min']">
                    Duration must be at least 1 day.
                  </div>
                </div>
              </div>
            </div>

            <div class="col-md-6">
              <div class="mb-3">
                <label for="subStatus" class="form-label">Status</label>
                <select
                  id="subStatus"
                  [(ngModel)]="newSubscription.is_active"
                  name="status"
                  class="form-select form-control"
                  required
                  #statusCtrl="ngModel"
                >
                  <option [ngValue]="undefined">-- Select Status --</option>
                  <option [ngValue]="1">Active</option>
                  <option [ngValue]="0">Inactive</option>
                </select>
                <div
                  class="text-danger small"
                  *ngIf="statusCtrl.invalid && statusCtrl.touched"
                >
                  Status is required.
                </div>
              </div>
            </div>

            <div class="col-md-12">
              <div class="mb-3">
                <label for="description" class="form-label">Description</label>
                <textarea
                  rows="8"
                  id="description"
                  [(ngModel)]="newSubscription.description"
                  name="description"
                  class="form-control"
                  required
                  minlength="10"
                  #descCtrl="ngModel"
                ></textarea>
                <div
                  class="text-danger small"
                  *ngIf="descCtrl.invalid && descCtrl.touched"
                >
                  <div *ngIf="descCtrl.errors?.['required']">
                    Description is required.
                  </div>
                  <div *ngIf="descCtrl.errors?.['minlength']">
                    Minimum 10 characters required.
                  </div>
                </div>
              </div>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer pb-0">
        <!-- <button type="button" class="btn btn-secondary" (click)="closeeditmodal()">
          Close
        </button> -->
        <span
          class="fa fa-remove closeModel close-modal position-absolute top-0 end-0 m-3 fs-5 cursor-pointer"
          (click)="closeModel()"
        ></span>
        <button
          type="button"
          class="btn dashboard-button-bg"
          [disabled]="subscriptionForm.invalid"
          (click)="saveupdateSubscription()"
        >
          {{ !newSubscription.id ? "Save" : "Update" }} User
        </button>

        <!-- <pre>{{newSubscription | json}}</pre> -->
      </div>
    </div>
  </div>
</div>
