<div class="d-flex justify-content-between align-items-center mb-3 bg-white p-3 rounded shadow-sm">
  <h4 class="mb-0 fw-bold">News List</h4>
  <div class="col-sm-5 d-flex">
    <input class="form-control me-2" type="search" placeholder="Search by Name and Description.." aria-label="Search"
      [(ngModel)]="searchnews" name="searchnews" (ngModelChange)="onSearchChange($event)">
    <button class="btn dashboard-button-bg text-nowrap" (click)="addEditNews()">
      <i class="fa fa-plus"> </i> Add News
    </button>
  </div>
</div>

<!-- // Pagination and Table -->
<div style="min-height: 500px;" class="bg-white">
  <table class="table table-responsive table-border table-striped">
    <thead>
      <tr>
        <th scope="col">Sr.&nbsp;No</th>
        <th scope="col">Banner</th>
        <th scope="col">Name</th>
        <th scope="col">Description</th>
        <th scope="col">Date</th>
        <th scope="col">Category</th>
        <th scope="col">Status</th>
        <th scope="col" class="text-center">Action</th>
      </tr>
    </thead>
    <tbody>
      <tr
        *ngFor="let news of newsList; let i = index">
        <th scope="row" class="align-middle">{{ i + 1 }}</th>

        <td class="align-middle">
          <img [src]="news.news_banner ? news.news_banner : 'assets/dummy.jpg'" alt="News Banner" width="50px"
            height="auto" class="img-thumbnail" style="height: 50px" />
        </td>
        <td class="align-middle" style="width: 300px;"> {{ news?.name ? (news.name.length > 25 ? (news.name |
          slice:0:25) + '...' : news.name) : '' | titlecase }}</td>
        <td class="align-middle" style="width: 300px;"> {{ news?.description ? (news.description.length > 25 ?
          (news.description | slice:0:25) + '...' : news.description) : '' | titlecase }}</td>
        <td class="align-middle">{{ news.news_date | date : "dd/MM/YYYY" }}</td>
        <td class="align-middle">{{ news.category || "N/A" }}</td>
        <td class="align-middle">
          <div class="custom-toggle" [class.active]="news.is_active === 1" (click)="toggleStatus(i, news)">
            <span class="toggle-label">
              {{ news.is_active === 1 ? "YES" : "NO" }}
            </span>
            <div class="toggle-knob"></div>
          </div>
        </td>
        <td class="text-center align-middle" style="width: 100px;">
          <button class="me-2 btn view-button btn-sm" (click)="addEditNews(news)">
            <i class="bi bi-pencil-square"></i>
          </button>
          <button class="btn view-button btn-sm" (click)="openDeleteModal(news)">
            <i class="bi bi-trash-fill"> </i>
          </button>
        </td>
      </tr>
    </tbody>
  </table>
  <div *ngIf="newsList.length === 0" class="alert alert-info alert-posstion">
    No News found.
  </div>
</div>
<div *ngIf="newsList.length > 0" class="has-text-centered">
  <!-- <pagination-controls (pageChange)="currentPage = $event"></pagination-controls> -->
	<div class="has-text-centered pt-3">
		<pagination class="custom-pagination" [totalItems]="totalItems" [(ngModel)]="currentPage"
			[itemsPerPage]="itemsPerPage" [maxSize]="5" [boundaryLinks]="true" previousText="«" nextText="»" firstText="First"
			lastText="Last" (pageChanged)="onPageChange($event)">
		</pagination>
</div>

<!-- Add/Edit News Modal -->
<div bsModal #showAddEditNewsModal="bs-modal" class="modal fade remove-modal-bg" tabindex="-1" role="dialog"
  aria-labelledby="myModalLabel" aria-hidden="true" [config]="{ backdrop: 'static', keyboard: false, animated: true }">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content p-4">
      <div class="modal-header pt-0">
        <h3 class="modal-title text-center fw-bold">
          {{ newsForm.value.id ? "Edit" : "Add" }} Event
        </h3>
      </div>
      <div class="modal-body row g-3">
        <form [formGroup]="newsForm">
          <div class="row">
            <div class="col-md-6 mb-3 ">
              <label for="name" class="form-label">Name</label>
              <input formControlName="name" type="text" class="form-control"
                [class.is-invalid]="f['name'].touched && f['name'].invalid">
              <div *ngIf="f['name'].touched && f['name'].invalid" class="invalid-feedback">Name is required.</div>
            </div>
            <div class="col-md-6 mb-3 ">
              <label for="news_date" class="form-label">News Date</label>
              <input formControlName="news_date" type="date" class="form-control"
                [class.is-invalid]="f['news_date'].touched && f['news_date'].invalid" id="news_date">
              <!-- Added id for better accessibility -->
              <div *ngIf="f['news_date'].touched && f['news_date'].invalid" class="invalid-feedback">
                News Date is required.
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-6">
              <div class="row">
                <div class="col-md-12">
                  <label for="category" class="form-label">News Category</label>
                  <select formControlName="category" class="form-control"
                    [class.is-invalid]="f['category'].touched && f['category'].invalid" id="category">
                    <option value="">Select a News Category</option>
                    <option value="current-news">Current News</option>
                    <option value="hard-news">Hard News</option>
                    <option value="soft-news">Soft News</option>
                    <option value="sports">Sports</option>
                    <option value="business-news">Business News</option>
                    <option value="crime">Crime</option>
                    <option value="entertainment">Entertainment</option>
                    <option value="investigative-news">Investigative News</option>
                    <option value="politics">Politics</option>
                    <option value="science">Science</option>
                    <option value="broadcast-journalism">Broadcast Journalism</option>
                    <option value="cultural-events">Cultural Events</option>
                    <option value="editorials">Editorials</option>
                    <option value="local-news">Local News</option>
                    <option value="weather">Weather</option>
                  </select>
                  <div *ngIf="f['category'].touched && f['category'].invalid" class="invalid-feedback">
                    News Category is required.
                  </div>
                </div>
                <div class="col-md-12 mb-3  text-center p-0">
                  <div class="position-relative">
                    <label for="fileToUpload" class="rounded-circle mt-3">
                      <div class="profile-pic text-center position:relative">
                        <img id="ImgPreview" [src]="profileImageView()" height="200px" width="200px"
                          class="rounded-circle" style="cursor: pointer;" />
                        <i class="fa fa-camera" style="position: relative;
                      right: 110px;
                      top: 81px;"></i>
                      </div>
                      <!-- <input type="File" name="fileToUpload" id="fileToUpload" class="form-control" accept="image/*"
                        hidden (change)="onFileChangeForCrop($event)"> -->
                      <input type="File" name="fileToUpload" id="fileToUpload" class="form-control" accept="image/*"
                        hidden (change)="onFileChange($event)">
                    </label>
                    <button *ngIf="this.selectedFiles.imageUrl" (click)="deleteImg()" class="rmv add-close-button"><i
                        class="fa fa-trash text-danger"></i>
                    </button>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-md-6 ">
              <label for="description" class="form-label">Description</label>
              <textarea [rows]="10" formControlName="description" class="form-control"
                [class.is-invalid]="f['description'].touched && f['description'].invalid"></textarea>
              <div *ngIf="f['description'].touched && f['description'].invalid" class="invalid-feedback">Description is
                required.</div>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer pb-0">
        <button type="button" class="btn dashboard-button-bg m-0" (click)="addOrUpdateNews()">
          {{ newsForm.value.id ? "Update" : "Save" }} News
        </button>
        <span type="button" (click)="closeModal()"
          class="fa fa-remove close-modal position-absolute top-0 end-0 m-3 fs-5 cursor-pointer"
          data-bs-dismiss="modal"></span>
      </div>
    </div>
  </div>
</div>

<!-- Crop Modal -->
<div class="modal fade remove-modal-bg" bsModal #imageCropModal="bs-modal" tabindex="-1" role="dialog"
  [config]="{backdrop: 'static', keyboard: false}" style="z-index: 999999999999;">
  <div class="modal-dialog modal-dialog-centered modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Crop Profile Image</h5>
        <span type="button" class="btn-close" (click)="this.imageCropModal.hide();" data-bs-dismiss="modal"
          class="fa fa-remove close-modal position-absolute top-0 end-0 m-3 fs-5 cursor-pointer">
        </span>
      </div>
      <div class="modal-body">
        <image-cropper [imageChangedEvent]="imageChangedEvent" [maintainAspectRatio]="true" [aspectRatio]="1"
          [resizeToWidth]="100"
          [resizeToHeight]="100"
          [cropperMinWidth]="100"
          [cropperMinHeight]="100"
          format="png" (imageCropped)="imageCropped($event)">
        </image-cropper>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn view-button" (click)="this.imageCropModal.hide();">
          Cancel
        </button>
        <button type="button" class="btn view-button" (click)="applyCroppedImage()"
          [disabled]="!croppedImage || isCropping">
          {{ isCropping ? 'Processing...' : 'Apply Crop' }}
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div bsModal #deleteNewsModal="bs-modal" class="modal fade remove-modal-bg" tabindex="-1" role="dialog"
  aria-labelledby="myModalLabel" aria-hidden="true" [config]="{backdrop: 'static', keyboard: false, animated: true}">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title text-center fw-bold">Confirm Delete</h3>
        <span type="button" class="btn-close" (click)="closeModal()" data-bs-dismiss="modal"
          class="fa fa-remove close-modal position-absolute top-0 end-0 m-3 fs-5 cursor-pointer"></span>
      </div>
      <div class="modal-body text-center">
        <b>Are you sure you want to delete this <span class="text-danger">{{currentNews.name}}</span>
          News?</b>
      </div>
      <!-- <pre>{{newSubscription | json}}</pre> -->
      <div class="modal-footer">
        <button type="button" class="btn dashboard-button-bg" (click)="closeModal()">No</button>
        <button type="button" class="btn dashboard-button-bg" (click)="confirmDelete()">Yes</button>
      </div>
    </div>
  </div>
</div>
